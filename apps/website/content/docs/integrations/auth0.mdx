---
title: "Auth0"
metadataTitle: "Usage with Auth0 | xmcp Documentation"
publishedAt: "2026-01-16"
summary: "Add secure authentication to your MCP server using Auth0"
description: "The Auth0 plugin provides authentication for your MCP server using Auth0 with scope-based authorization."
---

## Installation

Install the Auth0 plugin:

```bash
npm install @xmcp-dev/auth0
```

## Auth0 Tenant Setup

MCP clients use Dynamic Client Registration (DCR) and the OAuth 2.0 Resource Parameter to authenticate. Your Auth0 tenant requires specific configuration for this to work.

### 1. Enable Dynamic Client Registration

MCP clients register themselves automatically with your Auth0 tenant.

1. Go to **Auth0 Dashboard** → **Settings** → **Advanced**
2. Enable **"OIDC Dynamic Application Registration"**
3. Save changes

### 2. Enable Resource Parameter Compatibility Profile

1. Go to **Auth0 Dashboard** → **Settings** → **Advanced**
2. Enable **"Resource Parameter Compatibility Profile"**
3. Save changes

### 3. Promote Connection to Domain Level

DCR-registered clients are third-party by default and can only use domain-level connections.

1. Go to **Auth0 Dashboard** → **Authentication** → **Database**
2. Select your connection (e.g., `Username-Password-Authentication`)
3. Enable **"Enable for third-party clients"** (or "Promote to domain level")
4. Save changes

### 4. Create the API

1. Go to **Auth0 Dashboard** → **Applications** → **APIs**
2. Click **Create API**
3. Set:
   - **Name**: e.g., `MCP Server API`
   - **Identifier**: Your server URL **with trailing slash** (e.g., `http://localhost:3001/`)
4. Go to **Permissions** tab and add your scopes for the tools you want to protect:
   - **`tool:greet`**: Access the greeting tool
   - **`tool:whoami`**: Access the whoami tool

### 5. Set Default Audience

1. Go to **Auth0 Dashboard** → **Settings** → **General**
2. Under **API Authorization Settings**, set **Default Audience** to your API identifier (e.g., `http://localhost:3001/`)
3. Save changes

### 6. Note your Auth0 Domain

- Your domain follows `<tenant>.<region>.auth0.com` (e.g., `dev-xmcp.us.auth0.com`).
- You can find it in **Dashboard** → **Applications** → your app → **Settings** under **Basic Information**.
- Use this exact value for `AUTH0_DOMAIN` in your environment variables.

### 7. Enable RBAC

1. Go to **Auth0 Dashboard** → **Applications** → **APIs** → your API
2. Go to **Settings** tab
3. Enable **"Enable RBAC"**
4. Enable **"Add Permissions in the Access Token"**
5. Save changes

### 8. Create Roles and Assign Permissions

1. Go to **Auth0 Dashboard** → **User Management** → **Roles**
2. Click **Create Role** (e.g., "MCP User")
3. Go to **Permissions** tab → **Add Permissions**
4. Select your API and add permissions (e.g., `tool:greet`, `tool:whoami`)
5. Go to **Users** tab → **Add Users** to assign the role to users

### 9. Set Up Management API Access

1. Go to **Auth0 Dashboard** → **Applications** → **Applications**
2. Click **Create Application** → **Machine to Machine Applications**
3. Name it (e.g., "MCP Server M2M")
4. Select **Auth0 Management API** as the authorized API
5. Grant the **`read:resource_servers`** permission
6. Save and note the **Client ID** and **Client Secret**

## Environment Variables

Configure the following environment variables in your `.env` file:

```bash
# Credentials
AUTH0_DOMAIN=your-tenant.auth0.com  # <tenant>.<region>.auth0.com
AUTH0_AUDIENCE=http://127.0.0.1:3001/

# App configuration
BASE_URL=http://127.0.0.1:3001/

# Management API credentials
AUTH0_MGMT_CLIENT_ID=your-m2m-client-id
AUTH0_MGMT_CLIENT_SECRET=your-m2m-client-secret
```

<Callout variant="warning">
  `AUTH0_AUDIENCE` must match your Auth0 API identifier exactly.
</Callout>

## Set up the Provider

Create a `middleware.ts` file in your xmcp app's `src` directory:

```typescript title="src/middleware.ts"
import { auth0Provider } from "@xmcp-dev/auth0";

export default auth0Provider({
  domain: process.env.AUTH0_DOMAIN!,
  audience: process.env.AUTH0_AUDIENCE!,
  baseURL: process.env.BASE_URL!,
  management: {
    clientId: process.env.AUTH0_MGMT_CLIENT_ID!,
    clientSecret: process.env.AUTH0_MGMT_CLIENT_SECRET!,
  },
});
```

### Configuration Options

- **`domain`** - Your Auth0 domain (e.g., `your-tenant.auth0.com`)
- **`audience`** - The API identifier configured in Auth0
- **`baseURL`** - Base URL of your MCP server
- **`management`** - Management API configuration for permission enforcement
  - **`clientId`** - M2M application client ID
  - **`clientSecret`** - M2M application client secret
  - **`audience`** - (Optional) Management API audience, defaults to `https://<domain>/api/v2/`
  - **`resourceServerIdentifier`** - (Optional) API identifier to check permissions against
- **`scopesSupported`** - (Optional) List of custom scopes for OAuth metadata


## Public vs Protected Tools

The Auth0 plugin supports two types of tools:

### Public Tools

By default, all tools are public and accessible by any user that is authenticated.

### Protected Tools

Auth0 enables protecting specific tools by requiring a specific permission to access. To protect a tool follow these steps:

1. Add the permission `tool:<tool-name>` to your Auth0 API (e.g., `tool:whoami`)
2. Assign this permission to roles/users who should have access
3. Users without the permission will see: "You don't have permission to use the 'tool-name' tool."

xmcp automatically infers the tool's scope from its name in the metadata, resulting in `tool:<metadata.name>`.

## Get a user session

Access the authenticated user's session in your xmcp tools using `getAuthInfo()`.

### Example: Greet the user with their Auth0 identity

```typescript title="src/tools/greet.ts"
import { z } from "zod";
import type { InferSchema, ToolMetadata } from "xmcp";
import { getAuthInfo } from "@xmcp-dev/auth0";

export const schema = {
  name: z.string().optional().describe("The name of the user to greet"),
};

export const metadata: ToolMetadata = {
  name: "greet",
  description: "Greet the user with their Auth0 identity",
};

export default function greet({ name }: InferSchema<typeof schema>): string {
  const authInfo = getAuthInfo();
  const displayName = authInfo.user.name ?? name ?? "there";
  return `Hello, ${displayName}! Your Auth0 user ID is ${authInfo.user.sub}`;
}
```

The `authInfo` object contains token data and user claims:

- `authInfo.token` - The raw access token
- `authInfo.clientId` - OAuth client ID
- `authInfo.scopes` - Array of granted scopes
- `authInfo.user.sub` - User ID (subject claim)
- `authInfo.user.email` - User's email address
- `authInfo.user.name` - User's full name

## Get user details

Access the authenticated user's full profile using `getUser()`.

### Example: Get user details

```typescript title="src/tools/get-user-info.ts"
import type { ToolMetadata } from "xmcp";
import { getUser } from "@xmcp-dev/auth0";

export const metadata: ToolMetadata = {
  name: "get-user-info",
  description: "Get user details",
};

export default async function getUserInfo(): Promise<string> {
  const user = await getUser();
  return JSON.stringify(user, null, 2);
}
```

<Callout variant="warning">
  `getUser()` is only available when the `management` configuration is provided.
</Callout>

## Access the client

The `getAuth0Client()` and `getManagementClient()` functions give you access to the full Auth0 SDKs, allowing you to leverage all Auth0 features in your MCP tools.

### Example: Update user metadata

```typescript title="src/tools/update-preferences.ts"
import type { ToolMetadata } from "xmcp";
import { getManagementClient, getAuthInfo } from "@xmcp-dev/auth0";

export const metadata: ToolMetadata = {
  name: "update-preferences",
  description: "Update user preferences using the Management API",
};

export default async function updatePreferences(): Promise<string> {
  const authInfo = getAuthInfo();
  const client = getManagementClient();

  await client.users.update(authInfo.user.sub, {
    user_metadata: { theme: "dark" },
  });

  return "Preferences updated!";
}
```

The `ManagementClient` provides typed methods for all Auth0 Management API operations and is only available when the `management` configuration is provided. See the [official SDK](https://auth0.github.io/node-auth0/) for more details.

## Troubleshooting

These are the most common errors you may encounter when using the Auth0 plugin:

- **`unauthorized`** - The request is missing the Authorization header. The client needs to authenticate before accessing protected resources.
- **`token_expired`** - The access token has expired. MCP clients should automatically refresh tokens; users can disconnect and reconnect to get fresh tokens.
- **`invalid_token`** - Token verification failed. Check that your Auth0 configuration matches your tenant settings.
- **`InsufficientScopeError`** - The token doesn't have the required scopes for the tool. Ensure the scope is defined in your Auth0 API and requested during login.
- **`Service not found`** - The API identifier must match your `BASE_URL` exactly, including the trailing slash. MCP clients send a `resource` parameter that Auth0 uses as the audience, and any mismatch causes this error.

### OAuth Init Failed

If you see "OAuth init failed" when connecting:

- Ensure Dynamic Client Registration is enabled in Auth0 Settings → Advanced
- Enable the Resource Parameter Compatibility Profile in Auth0 Settings → Advanced

### Access Denied / Service Not Found

If you see "access denied" or "Service not found" errors:

- Your Auth0 API identifier must match `BASE_URL` exactly (including trailing slash)
- Promote your database connection to domain level (Authentication → Database → Enable for third-party clients)
- Set the Default Audience in Settings → General → API Authorization Settings

### Token Expired Errors

Access tokens are short-lived. If you see `token_expired` errors:

- MCP clients should automatically refresh tokens
- Users can disconnect and reconnect to get fresh tokens

### Invalid Token Errors

If token verification fails:

- Verify `AUTH0_DOMAIN` matches your Auth0 tenant
- Verify `AUTH0_AUDIENCE` matches your API identifier exactly (including trailing slash)

### Management API Not Configured

If you see "Management API configuration is required" or "401 Unauthorized":

- Add the `management` configuration to your middleware
- Ensure `AUTH0_MGMT_CLIENT_ID` and `AUTH0_MGMT_CLIENT_SECRET` are set
- Your M2M app needs the `read:resource_servers` permission on the Auth0 Management API

### Session Not Initialized

If `getAuthInfo()` throws an error:

- Ensure `auth0Provider` is exported as default from `middleware.ts`
- Ensure the tool is called on a route under `/mcp/*`
- Don't call `getAuthInfo()` at module load time—only inside tool handlers
